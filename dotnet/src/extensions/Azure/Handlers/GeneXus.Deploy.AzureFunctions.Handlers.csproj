<Project Sdk="Microsoft.NET.Sdk">
	<PropertyGroup>
		<TargetFrameworks>net8.0</TargetFrameworks>
		<OutputType>Exe</OutputType>
		<AzureFunctionsVersion>v4</AzureFunctionsVersion>
		<IsPublishable>false</IsPublishable>
		<AssemblyName>GeneXus.Deploy.AzureFunctions.Handlers</AssemblyName>
		<NoWarn>1701;1702;NU1701</NoWarn>
		<TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);CustomContentTarget</TargetsForTfmSpecificContentInPackage>
		<EnableDefaultCompileItems>false</EnableDefaultCompileItems>
	</PropertyGroup>
	
	<PropertyGroup>	
		<CosmosDBSupport>true</CosmosDBSupport>
		<ServiceBusSupport>true</ServiceBusSupport>
		<AzureQueueSupport>true</AzureQueueSupport>
		<TimerSupport>true</TimerSupport>
		<HttpSupport>true</HttpSupport>
		<BlobSupport>true</BlobSupport>
	</PropertyGroup>
	
	<PropertyGroup Condition="'$(Configuration)'=='Debug'">
	  <DebugType>portable</DebugType>
	</PropertyGroup>
	<PropertyGroup Condition="'$(Configuration)'=='Release'">
	  <DebugType>none</DebugType>
	</PropertyGroup>
	
	<ItemGroup>
		<Compile Include="Helpers\*;Program.cs" />
	</ItemGroup>

	<ItemGroup Condition="'$(BlobSupport)' == 'true' OR '$(AzureQueueSupport)' == 'true'">
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Extensions.Storage" Version="5.0.1" />
	</ItemGroup>

	<ItemGroup Condition="'$(BlobSupport)' == 'true'">
		<Compile Include="BlobHandler\BlobTriggerHandler.cs;Dummies\BlobTriggerDummy.cs" /> 
	</ItemGroup>
	
	<ItemGroup Condition="'$(CosmosDBSupport)' == 'true'">
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Extensions.CosmosDB" Version="4.0.1" />
		<Compile Include="CosmosDBHandler\CosmosDBTriggerHandler.cs;Dummies\CosmosDBTriggerDummy.cs" /> 
	</ItemGroup>

	<ItemGroup Condition="'$(ServiceBusSupport)' == 'true'">
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Extensions.ServiceBus" Version="4.2.1" />
		<Compile Include="ServiceBusHandler\ServiceBusTriggerHandler.cs;Dummies\ServiceBusQueueDummy.cs" />
	</ItemGroup>

	<ItemGroup Condition="'$(AzureQueueSupport)' == 'true'">
		<Compile Include="QueueHandler\QueueTriggerHandler.cs;Dummies\QueueTriggerDummy.cs" />
	</ItemGroup>

	<ItemGroup Condition="'$(TimerSupport)' == 'true'">
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Extensions.Timer" Version="4.0.1" />
		<Compile Include="TimerHandler\TimerTriggerHandler.cs;Dummies\TimerTriggerDummy.cs" />
	</ItemGroup>

	<ItemGroup Condition="'$(HttpSupport)' == 'true'">
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Extensions.Http" Version="3.0.13" />
		<Compile Include="HttpHandler\*;Dummies\HttpTriggerDummy.cs" />
	</ItemGroup>
	
	<ItemGroup>
		<PackageReference Include="Azure.Core" Version="1.36.0" />
		<PackageReference Include="Microsoft.Azure.Functions.Worker.Sdk" Version="1.15.1" OutputItemType="Analyzer" />
		<PackageReference Include="Microsoft.Azure.Functions.Worker" Version="1.19.0" />
		<PackageReference Include="Microsoft.Data.SqlClient" Version="2.1.2" />
		<PackageReference Include="StackExchange.Redis" Version="2.0.593" />
		<PackageReference Include="Newtonsoft.Json" Version="13.0.1" />
	</ItemGroup>
	
	<ItemGroup Condition="$(GenStdVersion)==''">
		<ProjectReference Include="..\..\..\dotnetcore\GxClasses.Web\GxClasses.Web.csproj" />
		<ProjectReference Include="..\..\..\dotnetcore\GxClasses\GxClasses.csproj" />
		<ProjectReference Include="..\..\..\dotnetcore\GxExcel\GxExcel.csproj" />
		<ProjectReference Include="..\..\..\dotnetcore\GxMail\GxMail.csproj" />
		<ProjectReference Include="..\..\..\dotnetcore\Providers\Cache\GxRedis\GxRedis.csproj" />
	</ItemGroup>
	<ItemGroup Condition="$(GenStdVersion)!=''">
		<PackageReference Include="GeneXus.Classes.Web.Core" Version="$(GenStdVersion)" />
		<PackageReference Include="GeneXus.Mail.Core" Version="$(GenStdVersion)" />
		<PackageReference Include="GeneXus.Excel.Core" Version="$(GenStdVersion)" />
		<PackageReference Include="GeneXus.Redis.Core" Version="$(GenStdVersion)" />
	</ItemGroup>
	<ItemGroup>
		<None Update="host.json">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
		<None Update="local.settings.json">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
			<CopyToPublishDirectory>Never</CopyToPublishDirectory>
		</None>
	</ItemGroup>
	<Target Name="CustomContentTarget">
		<ItemGroup Condition="$(GenStdVersion)==''">
			<TfmSpecificPackageFile Include="$(OutputPath)\$(MSBuildProjectName).deps.json;$(OutputPath)\$(MSBuildProjectName).runtimeconfig.json">
				<PackagePath>./lib/$(TargetFramework)/</PackagePath>
				<PackageCopyToOutput>true</PackageCopyToOutput>
			</TfmSpecificPackageFile>
			<TfmSpecificPackageFile Include="$(MSBuildProjectName).csproj;.\**\*.cs;host.json;" Exclude=".\obj\**\*.cs;.\bin\**\*">
				<PackagePath>./src/</PackagePath>
				<PackageCopyToOutput>true</PackageCopyToOutput>
			</TfmSpecificPackageFile>
		</ItemGroup>
	</Target>

	<Target Name="CopyFunctionsMetadata" AfterTargets="Build" Condition="Exists('functions.metadata')">
		<Copy SourceFiles="functions.metadata" DestinationFolder="$(OutputPath)"></Copy>
	</Target>
</Project>
